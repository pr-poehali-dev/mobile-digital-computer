# Безопасность приложения

## Защита от XSS-атак

Приложение включает комплексную защиту от XSS (Cross-Site Scripting) атак на всех уровнях:

### 1. Библиотека санитизации (`src/lib/sanitize.ts`)

Содержит утилиты для очистки пользовательских данных:

- **`sanitizeHtml()`** - экранирует HTML-теги и специальные символы
- **`sanitizeText()`** - удаляет управляющие символы
- **`sanitizeName()`** - очищает имена (кириллица, латиница, цифры, пробелы, дефисы)
- **`sanitizeAddress()`** - очищает адреса
- **`sanitizeEmail()`** - валидирует и нормализует email
- **`sanitizeId()`** - оставляет только безопасные символы для ID
- **`sanitizeUrl()`** - блокирует опасные протоколы (javascript:, data:, vbscript:)

### 2. Защита на уровне хранилища (`src/lib/store.ts`)

Все функции создания и обновления данных автоматически санитизируют входные данные:

#### Вызовы (Calls)
- `createCall()` - санитизирует адрес и тип вызова

#### Экипажи (Crews)
- `createCrew()` - санитизирует название экипажа и ID участников
- `updateCrew()` - санитизирует обновляемые данные
- `updateCrewStatus()` - санитизирует местоположение

#### Пользователи (Users)
- `createUser()` - санитизирует ID, имя и email
- `updateUser()` - санитизирует обновляемые поля

#### Логи активности
- `addActivityLog()` - санитизирует все текстовые поля в логах

### 3. Защита на уровне UI

Все формы ввода включают:

- **Ограничение длины** (`maxLength`) на всех текстовых полях
- **Санитизация в реальном времени** в обработчиках `onChange`
- **Валидация типов** данных

#### CallsTab
- Адрес: максимум 200 символов, санитизация адреса
- Тип вызова: максимум 100 символов, санитизация текста

#### AccountsTab
- ID пользователя: максимум 10 символов, только буквы/цифры/дефис
- Имя: максимум 100 символов, только безопасные символы
- Email: максимум 100 символов, валидация формата

#### CrewsTab
- Название экипажа: санитизация имен
- Местоположение: санитизация адресов

### 4. React защита

React автоматически экранирует все выводимые значения в JSX, что обеспечивает базовую защиту от XSS.

Мы НЕ используем:
- `dangerouslySetInnerHTML` - нигде в приложении
- `innerHTML` - только через React
- `eval()` или `Function()` - запрещены

## Дополнительные меры безопасности

### Content Security Policy (CSP)
Рекомендуется настроить CSP-заголовки на уровне сервера:

```
Content-Security-Policy: 
  default-src 'self'; 
  script-src 'self'; 
  style-src 'self' 'unsafe-inline'; 
  img-src 'self' data: https:;
```

### LocalStorage
Данные в localStorage хранятся в открытом виде. Не храните:
- Пароли (только хеши)
- Токены доступа к внешним API
- Персональные данные в нешифрованном виде

### Проверка входных данных

Все пользовательские данные проходят многоуровневую проверку:
1. **Frontend** - санитизация при вводе
2. **Store** - санитизация перед сохранением  
3. **React** - автоматическое экранирование при выводе

## Рекомендации

1. **Регулярно обновляйте зависимости** для закрытия известных уязвимостей
2. **Не отключайте санитизацию** даже для "доверенных" источников
3. **Проверяйте новые формы** - всегда добавляйте санитизацию при создании новых полей ввода
4. **Используйте TypeScript** - строгая типизация помогает предотвратить ошибки

## Тестирование безопасности

Протестируйте защиту, попробовав ввести:

```javascript
// Попытка XSS
<script>alert('XSS')</script>
<img src=x onerror=alert('XSS')>
javascript:alert('XSS')

// Попытка SQL-инъекции (не актуально для localStorage, но санитизация блокирует)
'; DROP TABLE users; --

// HTML-инъекция
<b>Bold text</b>
<iframe src="http://evil.com"></iframe>
```

Все эти попытки должны быть нейтрализованы санитизацией.

## Контакты

При обнаружении уязвимостей безопасности, пожалуйста, свяжитесь с командой разработки.
